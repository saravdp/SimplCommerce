name: CodeQL Analysis and Compare

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  codeql-analysis-v1-rc:
    name: CodeQL Analysis for Tag v1.0.0-rc
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Initialize submodules
      run: git submodule update --init --recursive

    - name: Set up .NET
      uses: actions/setup-dotnet@v2
      with:
        dotnet-version: '8.x'

    - name: Install Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16.x'

    - name: Install npm dependencies
      run: npm install

    #  - name: Run gulp tasks
    #    run: npm run gulp-copy-modules -- --configurationName Release

    - name: Restore dependencies
      run: dotnet restore SimplCommerce.sln

    - name: Build the code
      run: dotnet build SimplCommerce.sln --configuration Release

    - name: Update database
      run: dotnet ef database update --project src/SimplCommerce.WebHost

    - name: Set up CodeQL
      uses: github/codeql-action/init@v2
      with:
        languages: csharp

    - name: Perform CodeQL Analysis
      uses: github/codeql-action/analyze@v2
      with:
        upload: true

  
